{"version":3,"sources":["../src/skills.ts"],"sourcesContent":["/**\n * Skills Module\n *\n * Provides utilities for loading skills and generating JSONL path patterns.\n * Uses safe definitions (no React) to ensure compatibility with build tools.\n */\n\n// Use safe definitions (no React) via namespace import\nimport * as ComponentDefinitions from \"./definitions\";\n\n// Re-export registry for use by consumers\nexport const skillsRegistry: Record<string, string> = {};\n\n/**\n * Register a skill manually\n */\nexport function registerSkill(componentName: string, content: string): void {\n  skillsRegistry[componentName] = content;\n}\n\n/**\n * Get all registered skills\n */\nexport function getAllSkills(): Record<string, string> {\n  return { ...skillsRegistry };\n}\n\n/**\n * Map of component names to their JSONL array prop path patterns.\n * Used to generate TREE_CONTEXT_APPENDIX for the AI prompt.\n */\nconst COMPONENT_ARRAY_PROPS: Record<string, string> = {\n  // Data Display\n  List: \"items\",\n  TodoList: \"items\",\n  Timeline: \"events\",\n  Table: \"rows\",\n\n  // Communication\n  Message: \"messages\",\n  Email: \"emails\",\n\n  // Domain\n  Workout: \"items\",\n  Nutrition: \"meals\",\n  Flight: \"flights\",\n  Hotel: \"hotels\",\n  Trip: \"trips\",\n  Kanban: \"columns\",\n\n  // Canvas/Editor - content is Tiptap document with content array\n  Canvas: \"content.content\",\n  CanvasBlock: \"content.content\",\n};\n\n/**\n * Special nested paths for components with complex structures\n */\nconst NESTED_PATHS: Record<string, string[]> = {\n  Kanban: [\n    '- Kanban (Column): {\"op\":\"add\",\"path\":\"/elements/KEY/props/columns/-\",\"value\":{...}}',\n    '- Kanban (Card in Column): {\"op\":\"add\",\"path\":\"/elements/KEY/props/columns/COL_INDEX/cards/-\",\"value\":{...}}',\n  ],\n  // Canvas uses standard JSON Patch to add nodes to document content array\n  Canvas: [\n    '- Canvas (Paragraph): {\"op\":\"add\",\"path\":\"/elements/KEY/props/content/content/-\",\"value\":{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"...\"}]}}',\n    '- Canvas (Heading): {\"op\":\"add\",\"path\":\"/elements/KEY/props/content/content/-\",\"value\":{\"type\":\"heading\",\"attrs\":{\"level\":2},\"content\":[{\"type\":\"text\",\"text\":\"...\"}]}}',\n    '- Canvas (Table): {\"op\":\"add\",\"path\":\"/elements/KEY/props/content/content/-\",\"value\":{\"type\":\"table\",\"content\":[{\"type\":\"tableRow\",\"content\":[{\"type\":\"tableHeader\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"Header\"}]}]}]}]}}',\n    '- Canvas (CodeBlock): {\"op\":\"add\",\"path\":\"/elements/KEY/props/content/content/-\",\"value\":{\"type\":\"codeBlock\",\"attrs\":{\"language\":\"typescript\"},\"content\":[{\"type\":\"text\",\"text\":\"const x = 1;\"}]}}',\n    '- Canvas (BulletList): {\"op\":\"add\",\"path\":\"/elements/KEY/props/content/content/-\",\"value\":{\"type\":\"bulletList\",\"content\":[{\"type\":\"listItem\",\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"Item\"}]}]}]}}',\n    '- Canvas (Diagram): {\"op\":\"add\",\"path\":\"/elements/KEY/props/content/content/-\",\"value\":{\"type\":\"diagram\",\"attrs\":{\"code\":\"graph TD\\\\n  A-->B\",\"diagramType\":\"flowchart\"}}}',\n    '- Canvas (Math): {\"op\":\"add\",\"path\":\"/elements/KEY/props/content/content/-\",\"value\":{\"type\":\"mathBlock\",\"attrs\":{\"latex\":\"E = mc^2\"}}}',\n    '- Canvas (Callout): {\"op\":\"add\",\"path\":\"/elements/KEY/props/content/content/-\",\"value\":{\"type\":\"callout\",\"attrs\":{\"variant\":\"info\",\"title\":\"Note\"},\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"...\"}]}]}}',\n  ],\n};\n\n/**\n * Generate JSONL path patterns for component item updates.\n * This replaces the hardcoded TREE_CONTEXT_APPENDIX in route.ts.\n */\nexport function generateJSONLPaths(): string {\n  const lines: string[] = [\"COMPONENT ITEM UPDATES:\"];\n  const processedComponents = new Set<string>();\n\n  for (const [componentName, propName] of Object.entries(\n    COMPONENT_ARRAY_PROPS,\n  )) {\n    // Skip if this component has nested paths (handled separately)\n    if (NESTED_PATHS[componentName]) continue;\n\n    lines.push(\n      `- ${componentName}: {\"op\":\"add\",\"path\":\"/elements/KEY/props/${propName}/-\",\"value\":{...}}`,\n    );\n    processedComponents.add(componentName);\n  }\n\n  // Add nested path patterns\n  for (const [componentName, paths] of Object.entries(NESTED_PATHS)) {\n    lines.push(...paths);\n    processedComponents.add(componentName);\n  }\n\n  return lines.join(\"\\n\");\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWO,IAAM,iBAAyC,CAAC;AAKhD,SAAS,cAAc,eAAuB,SAAuB;AAC1E,iBAAe,aAAa,IAAI;AAClC;AAKO,SAAS,eAAuC;AACrD,SAAO,EAAE,GAAG,eAAe;AAC7B;AAMA,IAAM,wBAAgD;AAAA;AAAA,EAEpD,MAAM;AAAA,EACN,UAAU;AAAA,EACV,UAAU;AAAA,EACV,OAAO;AAAA;AAAA,EAGP,SAAS;AAAA,EACT,OAAO;AAAA;AAAA,EAGP,SAAS;AAAA,EACT,WAAW;AAAA,EACX,QAAQ;AAAA,EACR,OAAO;AAAA,EACP,MAAM;AAAA,EACN,QAAQ;AAAA;AAAA,EAGR,QAAQ;AAAA,EACR,aAAa;AACf;AAKA,IAAM,eAAyC;AAAA,EAC7C,QAAQ;AAAA,IACN;AAAA,IACA;AAAA,EACF;AAAA;AAAA,EAEA,QAAQ;AAAA,IACN;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF;AACF;AAMO,SAAS,qBAA6B;AAC3C,QAAM,QAAkB,CAAC,yBAAyB;AAClD,QAAM,sBAAsB,oBAAI,IAAY;AAE5C,aAAW,CAAC,eAAe,QAAQ,KAAK,OAAO;AAAA,IAC7C;AAAA,EACF,GAAG;AAED,QAAI,aAAa,aAAa,EAAG;AAEjC,UAAM;AAAA,MACJ,KAAK,aAAa,6CAA6C,QAAQ;AAAA,IACzE;AACA,wBAAoB,IAAI,aAAa;AAAA,EACvC;AAGA,aAAW,CAAC,eAAe,KAAK,KAAK,OAAO,QAAQ,YAAY,GAAG;AACjE,UAAM,KAAK,GAAG,KAAK;AACnB,wBAAoB,IAAI,aAAa;AAAA,EACvC;AAEA,SAAO,MAAM,KAAK,IAAI;AACxB;","names":[]}